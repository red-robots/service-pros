/*!
 * widgets
 * @version: 9.0.017.30
 * @license: Genesys Telecom Labs
 */
widgetsJsonpFunction([29],{"./webapp/plugins/cx-callback-service/cx-callback-service.js":function(e,a,r){"use strict";var i,t,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i=[r("./node_modules/jquery/dist/jquery.js"),r("./node_modules/urijs/src/URI.js")],void 0!==(t=function(e,a){var r=CXBus.registerPlugin("CallbackService");if(r){r.registerEvents(["ready","scheduled","scheduleError","availableSlots","availabilityError"]);var i={},t={dataURL:"",iAjaxTimeout:3e3,apiKey:"",callDirection:"",apiVersion:"v1",serviceName:""},s={numberOfDays:{v1:"number-of-days",v3:"numberOfDays"},maxTimeSlots:{v1:"max-time-slots",v3:"maxTimeSlots"},apiKey:{v1:"apikey",v3:"x-api-key"}},n={postHttp:function(a,r){var i={},o=e.Deferred();return e.extend(i,r||{}),e.ajax({url:a,data:i,crossDomain:!0,type:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},beforeSend:function(e){t.iApiKey&&e.setRequestHeader(s.apiKey[t.apiVersion],t.iApiKey)},success:function(e){o.resolve(e||{})},error:function(e){o.reject(e||{})}}),o.promise()},getHttp:function(a){var r=e.Deferred();return e.ajax({url:a,dataType:"json",type:"GET",crossDomain:!0,beforeSend:function(e){t.iApiKey&&e.setRequestHeader(s.apiKey[t.apiVersion],t.iApiKey),"v3"===t.apiVersion&&e.setRequestHeader("Content-Type","application/json")},success:function(e){r.resolve(e||{})},error:function(e){r.reject(e||{})}}),r.promise()},getRequestParamsAPIv3:function(e,a){var r={};return r.userData={},e&&(a&&(r.serviceName=a),Object.keys(e).forEach(function(a){"_customer_number"===a||"phonenumber"===a?r.phoneNumber=e._customer_number||e.phonenumber:"_desired_time"===a||"desiredtime"===a?r.desiredTime=e._desired_time||e.desiredtime:r.userData[a]=e[a]})),r}};r.registerCommand("schedule",function(a){if(e.isEmptyObject(a.data))a.deferred.reject("No data found to schedule callback");else{var o={},s=a.data,c="",d=s.serviceName||t.serviceName;"v3"==t.apiVersion?d?(c=t.dataURL+"/create",o=n.getRequestParamsAPIv3(s,d)):a.deferred.reject("Invalid configuration. serviceName should be configured."):(c=t.dataURL,o._call_direction=s.calldirection||t.callDirection||"",s.phonenumber&&(o._customer_number=s.phonenumber),s.subject&&(o.subject=s.subject),s.email&&(o.email=s.email),s.desiredtime&&(o._desired_time=s.desiredtime),(s.waitforagent||s.waitForAgent)&&(o._wait_for_agent=s.waitforagent||s.waitForAgent),(s.waitforuserconfirm||s.waitForUserConfirm)&&(o._wait_for_user_confirm=s.waitforuserconfirm||s.waitForUserConfirm),(s.mediatype||s.mediaType)&&(o._media_type=s.mediatype||s.mediaType),(s.callbackstate||s.callbackState)&&(o._callback_state=s.callbackstate||s.callbackState),(s.ursvirtualqueue||s.ursVirtualQueue)&&(o._urs_virtual_queue=s.ursvirtualqueue||s.ursVirtualQueue),e.extend(o,i,s.userData||{},s)),n.postHttp(c,o).done(function(e){r.publish("scheduled",e),a.deferred.resolve(e)}).fail(function(e){r.publish("scheduleError",e),a.deferred.reject(e)})}}),r.registerCommand("availability",function(i){if(e.isEmptyObject(i.data))i.deferred.reject("No query parameters passed for callback availability service");else{var o=i.data,c=o.serviceName||t.serviceName,d="";d=t.dataURL+"/availability","v3"===t.apiVersion&&(c?d=t.dataURL+"/availability/"+c:i.deferred.reject("Invalid configuration. serviceName should be configured.")),d=new a(d),o.startDate&&d.addSearch("start",o.startDate),o.numberOfDays&&d.addSearch(s.numberOfDays[t.apiVersion],o.numberOfDays),o.endDate&&d.addSearch("end",o.endDate),o.maxTimeSlots&&d.addSearch(s.maxTimeSlots[t.apiVersion],o.maxTimeSlots),n.getHttp(d).done(function(e){if("v3"===t.apiVersion)if(e&&e.data&&e.data.slots){var a=e.data.slots,o={},s=t.timezone?"localTime":"utcTime";a.forEach(function(e){o[e[s]]=e.capacity}),r.publish("availableSlots",{response:e,slots:o}),i.deferred.resolve(e)}else r.publish("availabilityError",e),i.deferred.reject(e);else r.publish("availableSlots",e),i.deferred.resolve(e)}).fail(function(e){r.publish("availabilityError",e),i.deferred.reject(e)})}}),r.registerCommand("configure",function(a){if(a.data&&!e.isEmptyObject(a.data)){var r=a.data,s=t;"object"==(void 0===r?"undefined":o(r))&&("string"==typeof r.dataURL&&(s.dataURL=r.dataURL),"string"!=typeof r.apikey&&"number"!=typeof r.apikey||(s.iApiKey=r.apikey),"number"==typeof r.ajaxTimeout&&(s.iAjaxTimeout=r.ajaxTimeout),"string"==typeof r.callDirection&&(s.callDirection=r.callDirection),"object"==o(r.userData)&&e.extend(i,r.userData),"string"==typeof r.apiVersion&&(s.apiVersion=r.apiVersion.toLowerCase()),"string"==typeof r.serviceName&&(s.serviceName=r.serviceName),"string"==typeof r.timezone&&(s.timezone=r.timezone)),a.deferred.resolve()}else a.deferred.reject({error:"Invalid configuration"})}),r.subscribe("GWE.ready",function(){r.command("GWE.getIDs").done(function(a){e.extend(i,a)})}),r.command("configure",_genesys.widgets.callback),r.ready(),r.republish("ready")}}.apply(a,i))&&(e.exports=t)}},["./webapp/plugins/cx-callback-service/cx-callback-service.js"]);
/*!
 * widgets
 * @version: 9.0.017.30
 * @license: Genesys Telecom Labs
 */
widgetsJsonpFunction([27],{"./webapp/plugins/cx-gwe/cx-gwe.js":function(e,n,t){"use strict";var o,a,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};o=[t("./node_modules/jquery/dist/jquery.js"),t("./webapp/plugins/cx-common/cx-common.js")],void 0!==(a=function(e,n){function t(){if(!W)return!1;for(var e in j)if(j[e].opened)return!0;return!1}function o(n){if(t())_gt.push(["event","Disposition",{data:{actionID:n.actionID,engagementID:n.engagementID,media:n.media,result:"error",code:"mediaBusy"}}]);else{w=n;var o=n.container||{};o==={}&&n.content&&(o.type="custom"),o.body=n.content,v.command("Toaster.open",o).done(function(t){t.html&&(r(),D=e(t.html),D.find(".cx-btn.cx-btn-primary").on("click",function(){D.data("timeout",""),u(n.dispositions.accept.code,n.media,n.engagementID,n.actionID),d().done(function(){n.dispositions.accept.command&&v.command(n.dispositions.accept.command,n.dispositions.accept.data)})}),D.find(".cx-btn.cx-btn-default").on("click",function(){D.data("timeout",""),u(n.dispositions.cancel.code,n.media,n.engagementID,n.actionID),d(),n.dispositions.cancel.command&&v.command(n.dispositions.cancel.command,n.dispositions.cancel.data)}),D.find(".cx-button-close").on("click",function(){D.data("timeout",""),u(n.dispositions.cancel.code,n.media,n.engagementID,n.actionID),n.dispositions.cancel.command&&v.command(n.dispositions.cancel.command,n.dispositions.cancel.data)}),v.command("Watchman.countdown",{time:parseInt(n.timeout/1e3)||30}).done(function(e){D.data("timeout",e),n.dispositions.timeout.code&&v.subscribe(e,function(){E&&D.data("timeout")==e&&(k.countdownEvent&&v.unsubscribe(k.countdownEvent),u(n.dispositions.timeout.code,n.media,n.engagementID,n.actionID),d().done(function(){n.dispositions.timeout.command&&v.command(n.dispositions.timeout.command,n.dispositions.timeout.data)}))})}),E=!0)}).fail(function(e){})}}function a(n){if(t())_gt.push(["event","Disposition",{data:{actionID:n.actionID,engagementID:n.engagementID,media:n.type,result:"error",code:"mediaBusy"}}]);else{var o={type:"generic",title:n.subject||"Need help?",body:n.message||"Let us know if we can help out.",icon:"chat",controls:"close",buttons:{type:"binary",primary:n.acceptBtnCaption||"Start chat",secondary:n.cancelBtnCaption||"No thanks"}};v.command("Toaster.open",o).done(function(t){t.html&&(s(),C=e(t.html),C.find(".cx-btn.cx-btn-primary").on("click",function(){k.countdownEvent&&v.unsubscribe(k.countdownEvent),v.command("Toaster.close").done(function(){l(y.ACCEPT);var e={},t=n.chatOptions||{};!1===t.registration&&"object"==i(t.userData)&&(e.autoSubmit=!0,e.firstname=t.userData.firstName,e.lastname=t.userData.lastName,e.email=t.userData.email),_gt.push(["getIDs",function(n){h=n,v.command("WebChat.open",{attachedData:{visitID:n.visitID,pageID:n.pageID,webengagement:""},form:e,userData:t.userData||{}})}]),s()})}),C.find(".cx-btn.cx-btn-default").on("click",function(){k.countdownEvent&&v.unsubscribe(k.countdownEvent),s(),l(y.CANCEL)}),C.find(".cx-button-close").on("click",function(){k.countdownEvent&&v.unsubscribe(k.countdownEvent),s(),l(y.CANCEL)}),v.command("Watchman.countdown",{time:parseInt(n.inviteTimeout)||30}).done(function(e){k.countdownEvent=e,v.subscribe(e,function(){l(y.TIMEOUT),C&&c()})})),I=!0}).fail(function(e){})}}function c(){C&&v.command("Toaster.close").done(function(){s()})}function d(){if(D)return v.command("Toaster.close").done(function(){r()})}function s(){C&&(C.remove(),C=!1)}function r(){D&&(D.remove(),D=!1,w=!1)}function u(e,n,t,o){h?_gt.push(["event","Disposition",{data:{actionID:o,engagementID:t,result:e,media:n}}]):_gt.push(["getIDs",function(a){h=a,_gt.push(["event","Disposition",{data:{actionID:o,engagementID:t,result:e,media:n}}])}]),E=!1}function l(n,t){_gt.push(["getIDs",function(t){h=t,e.ajax({type:"GET",crossDomain:!0,url:(b.httpEndpoint||b.httpsEndpoint)+"/server/data/invites",xhrFields:{withCredentials:!0},data:{result:n,media:"chat",visitID:t.visitID,pageID:t.pageID,alias:t.alias,engagementID:_,webengagement:""}}).done(function(e){})}]),I=!1}function m(){!function(e){if(!document.getElementById("_gt")){var n=document.createElement("script");n.id="_gt",n.src=(b.httpEndpoint||b.httpsEndpoint)+"/server/resources/js/build/GTCJ.min.js",(document.getElementsByTagName("head")[0]||document.body).appendChild(n)}}(),window.addEventListener&&e(window).on("beforeunload",p),window.attachEvent&&(window.attachEvent("onbeforeunload",p),window.attachEvent("onunload",p))}function p(){I&&l(y.PAGE_EXIT),E&&(u(w.dispositions.pageExit.code,w.media,w.engagementID,w.actionID),w.dispositions.pageExit.command&&v.command(w.dispositions.pageExit.command,w.dispositions.pageExit.data))}function f(e){v.command("Offers.configure",e).done(function(){v.command("Offers.open").done(function(){})})}function g(e){v.command("SendMessage.open").done(function(){})}window._gt=window._gt||[];var v=CXBus.registerPlugin("GWE"),b={},h=!1,C=!1,D=!1,w=!1,E=!1,I=!1,y={ACCEPT:"accept",TIMEOUT:"timeout",PAGE_EXIT:"pageExit",CANCEL:"cancel"},S={"WebChatService.error":!0,"WebChatService.clientConnected":!0,"WebChatService.agentConnected":!0,"WebChatService.started":!0,"WebChatService.ended":!0,"WebChatService.disconnected":!0,"WebChat.opened":!0,"WebChat.started":!0,"WebChat.cancelled":!0,"WebChat.completed":!0,"WebChat.closed":!0,"SendMessageService.error":!0,"SendMessage.opened":!0,"SendMessage.started":!0,"SendMessage.cancelled":!0,"SendMessage.completed":!0,"SendMessage.closed":!0,"CallbackService.scheduled":!0,"CallbackService.scheduleError":!0,"CallbackService.availabilityError":!0,"Callback.opened":!0,"Callback.started":!0,"Callback.cancelled":!0,"Callback.completed":!0,"Callback.closed":!0,"CallUs.opened":!0,"CallUs.closed":!0,"ChannelSelector.opened":!0,"ChannelSelector.closed":!0,"CoBrowse.started":!0,"CoBrowse.stopped":!0,"KnowledgeCenterService.sessionChanged":!0,"KnowledgeCenterService.noResultsFound":!0,"KnowledgeCenterService.documentOpened":!0,"KnowledgeCenterService.searched":!0,"KnowledgeCenterService.voted":!0,"Search.opened":!0,"Search.closed":!0,"ChatDeflection.started":!0,"ChatDeflection.ended":!0},x=function(e){var n=e.event,t={data:{}};t.data[n]=e.data|{},_gt.push(["event",n,t])},_="",k={countdownEvent:null},W=!0,j={WebChat:{opened:!1},SendMessage:{opened:!1},Callback:{opened:!1},CallUs:{opened:!1}};if(v){for(var T in j)v.subscribe(T+".opened",function(){j[T].opened=!0}),v.subscribe(T+".closed",function(){j[T].opened=!1});v.registerEvents(["ready"]),v.registerCommand("getIDs",function(e){h?e.deferred.resolve(h):_gt.push(["getIDs",function(n){h=n,e.deferred.resolve(h)}])}),v.registerCommand("sendDisposition",function(e){if(_gt){var n={};for(var t in e.data)n[t]=e.data[t];_gt.push(["event","Disposition",{data:n}]),e.deferred.resolve()}else e.deferred.reject("GWE is not available")}),v.registerCommand("push",function(e){if(_gt){var n=e.data;"object"==(void 0===n?"undefined":i(n))&&"function"==typeof n.shift&&"number"==typeof n.length&&n.length>0?(_gt.push(n),e.deferred.resolve()):e.deferred.reject("Attempted to push invalid data. Expected an array of values.")}else e.deferred.reject("GWE is not available")}),v.registerCommand("invite",function(e){o(e.data)}),v.registerCommand("configure",function(n){if("GWE"==n.commander||"App"==n.commander)if(n.data){if(n.data.httpEndpoint||n.data.httpsEndpoint){b=n.data,_gt.push(["config",b]),_gt.push(["getIDs",function(e){h=e}]),_gt.push(["on","notificationMessage",function(e){return"gpe.setVariable"===e.channel&&"chat"===e.data.value.type?(_=e.data.value.engagementID,a(e.data.value),!1):"gpe.setVariable"===e.channel&&"offers"===e.data.value.type?(_=e.data.value.engagementID,f(e.data.value),!1):("gpe.setVariable"===e.channel&&"sendmessage"===e.data.value.type&&(_=e.data.value.engagementID,g(e.data.value)),"gpe.appendContent"!==e.channel&&("CXBus"===e.channel?(v.command("Remote.execute",e.data||{}),!1):void 0))}]),"object"==i(n.data.trackedEvents)&&(S=e.extend(S,n.data.trackedEvents)),!1===n.data.smartInvites&&(W=!1);for(var t in S)!0===S[t]&&v.subscribe(t,x);m()}n.deferred.resolve()}else n.deferred.reject("Invalid configuration");else n.deferred.reject("Forbidden: Access Denied")}),v.command("configure",n.checkPath(window,"_genesys.cxwidget.gwe")||n.checkPath(window,"_genesys.widgets.gwe")||{}),v.subscribe("App.closeAll",function(e){}),v.ready(),v.republish("ready")}}.apply(n,o))&&(e.exports=a)}},["./webapp/plugins/cx-gwe/cx-gwe.js"]);